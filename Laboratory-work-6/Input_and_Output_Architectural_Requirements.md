# V1.5 Архітектура введення та виведення

У версії 4.0 ми відійшли від терміна «серверна сторона» як терміна завантаженої межі довіри. Межа довіри все ще викликає занепокоєння – прийняття рішень у ненадійних браузерах або клієнтських пристроях можна обійти. Однак у основних архітектурних розгортаннях сьогодні точка забезпечення довіри різко змінилася. Тому, коли в ASVS використовується термін «рівень довіреної служби», ми маємо на увазі будь-яку довірену точку контролю, незалежно від розташування, наприклад мікросервіс, безсерверний API, сторону сервера, довірений API на клієнтському пристрої, який має безпечне завантаження, партнерські чи зовнішні API тощо.

Термін «ненадійний клієнт» тут стосується технологій на стороні клієнта, які відтворюють рівень презентації, які зазвичай називають технологіями «інтерфейсу». Термін «серіалізація» тут стосується не лише надсилання даних по дроту, наприклад масиву значень або отримання та читання структури JSON, а й передачі складних об’єктів, які можуть містити логіку.

|   #   |                                                                                                                                                              Опис                                                                                                                                                              | L1 | L2 | L3 | CWE  |
|:-----:|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:--:|:--:|:--:|:----:|
| 1.5.1 |                                                                Переконайтеся, що вимоги до введення та виведення чітко визначають, як управляти та опрацьовувати дані на основі типу, вмісту та застосовних законів, нормативних актів та інших вимог політики.                                                                |    | +  | +  | 1029 |
| 1.5.2 | Переконайтеся, що серіалізація не використовується під час спілкування з ненадійними клієнтами. Якщо це неможливо, переконайтеся, що необхідні засоби контролю цілісності (і, можливо, шифрування, якщо надсилаються конфіденційні дані) застосовуються, щоб запобігти атакам десеріалізації, включаючи впровадження об’єктів. |    | +  | +  | 502  |
| 1.5.3 |                                                                                                                     Переконайтеся, що перевірка введених даних виконується на рівні довіреної служби. (C5)                                                                                                                     |    | +  | +  | 602  |
| 1.5.4 |                                                                                                  Переконайтеся, що вихідне кодування відбувається близько до або за допомогою інтерпретатора, для якого воно призначене. (C4)                                                                                                  |    | +  | +  | 116  |

## C4: Кодування та екранування даних

### Опис

Кодування та екранування — це захисні методи, призначені для припинення ін’єкційних атак. Кодування (зазвичай називається «кодування виводу») передбачає переклад спеціальних символів у іншу, але еквівалентну форму, яка більше не є небезпечною в цільовому інтерпретаторі, наприклад, переклад символу ```<``` на ```&lt;``` рядок під час запису на сторінку HTML. Екранування передбачає додавання спеціального символу перед символом/рядком, щоб уникнути його неправильного тлумачення, наприклад, додавання символу ```\``` перед символом ```"``` (подвійні лапки), щоб він інтерпретувався як текст, а не як закриття рядка.

Кодування виводу найкраще застосовувати безпосередньо перед тим, як вміст передається цільовому інтерпретатору. Якщо цей захист виконується занадто рано під час обробки запиту, то кодування або екранування може заважати використанню вмісту в інших частинах програми. Наприклад, якщо ви екрануєте вміст HTML перед збереженням цих даних у базі даних, а інтерфейс користувача автоматично екранує ці дані вдруге, вміст не відображатиметься належним чином через подвійне екранування.

## C5: Валідація всіх введених даних

### Опис

Перевірка вхідних даних — це техніка програмування, яка гарантує, що лише правильно відформатовані дані можуть входити до компонента програмної системи.

## Категорія CWE: десятка найкращих OWASP 2017 року, категорія A3 – розкриття конфіденційних даних

### Опис

Слабкі місця в цій категорії пов’язані з категорією A3 у рейтингу OWASP Top Ten 2017.

### Членство

| Природа членства |    Тип    | Ідентифікатор |                               Назва                                |
|:----------------:|:---------:|:-------------:|:------------------------------------------------------------------:|
|     Учасник      |    Вид    |     1026      |                Слабкі місця в OWASP Top Ten (2017)                 |
|   Має учасника   |  Варіант  |      220      |  Зберігання файлу з конфіденційними даними в кореневій папці FTP   |
|   Має учасника   |  Основа   |      295      |                  Неналежна перевірка сертифіката                   |
|   Має учасника   |   Клас    |      311      |              Відсутнє шифрування конфіденційних даних              |
|   Має учасника   |  Основа   |      312      |             Чисте зберігання конфіденційної інформації             |
|   Має учасника   |  Основа   |      319      |       Передача конфіденційної інформації у відкритому тексті       |
|   Має учасника   | Категорія |      320      |                     Помилки керування ключами                      |
|   Має учасника   |  Основа   |      325      |                   Відсутній криптографічний крок                   |
|   Має учасника   |   Клас    |      326      |                  Неадекватна міцність шифрування                   |
|   Має учасника   |   Клас    |      327      | Використання зламаного або ризикованого криптографічного алгоритму |
|   Має учасника   |  Основа   |      328      |                     Використання слабкого хешу                     |
|   Має учасника   |  Основа   |      359      | Розкриття приватної персональної інформації неавторизованій особі  |

## CWE-502: Десеріалізація ненадійних даних

### Опис

Слабкі місця в цій категорії пов’язані з категорією A3 у рейтингу OWASP Top Ten 2017.

### Розширений опис

Часто зручно серіалізувати об’єкти для зв’язку або зберегти їх для подальшого використання. Однак десеріалізовані дані або код часто можна змінити без використання наданих функцій доступу, якщо вони не використовують криптографію для захисту. Більше того, будь-яка криптографія все одно буде захистом на стороні клієнта, що є небезпечним припущенням безпеки.

Дані, яким не можна довіряти, не можна вважати правильними.

Коли розробники не накладають обмежень на «ланцюжки гаджетів» або ряди екземплярів і викликів методів, які можуть самостійно виконуватися під час процесу десеріалізації (тобто до того, як об’єкт буде повернено абоненту), інколи зловмисники можуть використовувати їх для того щоб виконувати несанкціоновані дії, наприклад генерувати оболонку.

### Затронуті платформи

#### Мови

* Java (_поширеність не визначена_)
* Ruby (_поширеність не визначена_)
* PHP (_поширеність не визначена_)
* Python (_поширеність не визначена_)
* JavaScript (_поширеність не визначена_)

#### Технології

* Клас: ICS/OT (_часто поширено_)

### Загальні наслідки

|  Сфера дії  |                                                                                                                                                Вплив                                                                                                                                                 |
|:-----------:|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
| Цілісність  |                                                                __Технічний вплив:__ _Зміна даних програми; Неочікуваний стан_<br>Зловмисники можуть змінювати неочікувані об’єкти або дані, які вважалися безпечними для модифікації.                                                                |
| Доступність |                                                   __Технічний вплив:__ _DoS: Споживання ресурсів (ЦП)_<br>Якщо функція робить припущення про те, коли завершувати роботу, на основі вартового в рядку, вона легко може ніколи не припинити роботу.                                                   |
|    Інше     | __Технічний вплив:__ _DoS: Залежить від контексту_<br>Наслідки можуть сильно відрізнятися, оскільки це залежить від того, які об’єкти чи методи десеріалізуються та як вони використовуються. Припускати, що код десеріалізованого об’єкта дійсний, небезпечно, це може стати причиною експлуатації. |

### Ймовірність експлойту

Середня

## CWE-602: Застосування клієнтською стороною безпеки серверної сторони

### Опис

Продукт складається з сервера, який покладається на клієнта для реалізації механізму, призначеного для захисту сервера.

### Розширений опис

Коли сервер покладається на механізми захисту, розміщені на стороні клієнта, зловмисник може змінити поведінку на стороні клієнта, щоб обійти механізми захисту, що призводить до потенційно неочікуваної взаємодії між клієнтом і сервером. Наслідки будуть різними залежно від того, які механізми намагаються захистити.

### Затронуті платформи

#### Мови

* Клас: Не залежить від мови (_поширеність не визначена_)

#### Технології

* Клас: ICS/OT (_поширеність не визначена_)
* Клас: Мобільний (_поширеність не визначена_)

### Загальні наслідки

|             Сфера дії              |                                                                                                                                                                     Вплив                                                                                                                                                                     |
|:----------------------------------:|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
| Управління доступом<br>Доступність | __Технічний вплив:__ _Механізм захисту Bypass; DoS: Збій, Вихід або Перезапуск_<br>Валідаційні перевірки на стороні клієнта можна легко обійти, дозволяючи неправильно сформованому або неочікуваному введенню передаватись в програму, потенційно як надійні дані. Це може призвести до неочікуваних станів, поведінки та, можливо, до збою. |
|        Управління доступом         |                                          __Технічний вплив:__ _Механізм захисту Bypass; Отримання привілеїв або присвоювання собі ідентифікації_<br>Перевірки автентифікації на стороні клієнта можна легко обійти, дозволяючи клієнтам підвищувати свої рівні доступу та виконувати ненавмисні дії.                                          |

### Ймовірність експлойту

Середня

## CWE-116: Неправильне кодування або екранування вихідних даних

### Опис

Продукт готує структуроване повідомлення для зв’язку з іншим компонентом, але кодування або екранування даних відсутні або виконані неправильно. У результаті запланована структура повідомлення не зберігається.

### Розширений опис

Неправильне кодування або екранування може дозволити зловмисникам змінювати команди, які надсилаються іншому компоненту, вставляючи замість них шкідливі команди.

Більшість продуктів дотримується певного протоколу, який використовує структуровані повідомлення для зв’язку між компонентами, такими як запити чи команди. Ці структуровані повідомлення можуть містити необроблені дані з вкрапленням метаданих або керуючої інформації. Наприклад, «GET /index.html HTTP/1.1» — це структуроване повідомлення, що містить команду («GET») з одним аргументом («/index.html») і метадані про те, яка версія протоколу використовується («HTTP/ 1,1").

Якщо програма використовує вхідні дані, надані зловмисником, для створення структурованого повідомлення без належного кодування або екранування, тоді зловмисник може вставити спеціальні символи, які спричинять інтерпретацію даних як керуючої інформації або метаданих. Отже, компонент, який отримує вихідні дані, виконуватиме неправильні операції або іншим чином неправильно інтерпретуватиме дані.

### Затронуті платформи

#### Мови

* Клас: Не залежить від мови (_часто поширений_)

#### Технології

* Сервер бази даних (_часто поширений_)
* Веб-сервер (_часто поширений_)

### Загальні наслідки

|                              Сфера дії                               |                                                                                                                               Вплив                                                                                                                              |
|:--------------------------------------------------------------------:|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
|                              Цілісність                              |           __Технічний вплив:__ _Змінення даних програми_<br>Зв'язок між компонентами може бути змінений неочікуваним чином. Неочікувані команди можуть виконуватися в обхід інших механізмів безпеки. Вхідні дані можуть бути неправильно витлумачені.           |
| Цілісність<br>Конфіденційність<br>Доступність<br>Управління доступом | __Технічний вплив:__ _Виконання несанкціонованого коду або команди_<br>Зв'язок між компонентами може бути змінений неочікуваним чином. Неочікувані команди можуть виконуватися в обхід інших механізмів безпеки. Вхідні дані можуть бути неправильно витлумачені. |
|                           Конфіденційність                           | __Технічний вплив:__ _Механізм захисту Bypass_<br>Зв'язок між компонентами може бути змінений неочікуваним чином. Неочікувані команди можуть виконуватися в обхід інших механізмів безпеки. Вхідні дані можуть бути неправильно витлумачені. |

### Ймовірність експлойту

Висока
